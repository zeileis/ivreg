<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ivreg: Two-Stage Least-Squares Regression with Diagnostics • ivreg</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="ivreg: Two-Stage Least-Squares Regression with Diagnostics">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ivreg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6-5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/ivreg.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Diagnostics-for-2SLS-Regression.html">Diagnostics for 2SLS Regression</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/zeileis/ivreg/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>ivreg: Two-Stage Least-Squares Regression with
Diagnostics</h1>
                        <h4 data-toc-skip class="author">John Fox,
Christian Kleiber, Achim Zeileis</h4>
            
            <h4 data-toc-skip class="date">last modified:
2024-04-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/zeileis/ivreg/blob/main/vignettes/ivreg.Rmd" class="external-link"><code>vignettes/ivreg.Rmd</code></a></small>
      <div class="hidden name"><code>ivreg.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <strong>ivreg</strong> package provides a comprehensive
implementation of instrumental variables regression using two-stage
least-squares (2SLS) estimation. The standard regression functionality
(parameter estimation, inference, robust covariances, predictions, etc.)
is derived from and supersedes the <code><a href="../reference/ivreg.html">ivreg()</a></code> function in the
<a href="https://CRAN.R-project.org/package=AER" class="external-link"><strong>AER</strong></a>
package. Additionally, various regression diagnostics are supported,
including hat values, deletion diagnostics such as studentized residuals
and Cook’s distances; graphical diagnostics such as
component-plus-residual plots and added-variable plots; and effect plots
with partial residuals.</p>
<p>In order to provide all of this functionality the
<strong>ivreg</strong> package integrates seamlessly with other packages
by providing suitable S3 methods, specifically for generic functions in
the <a href="https://www.R-project.org/" class="external-link">base-R</a>
<strong>stats</strong> package, and in the <a href="https://CRAN.R-project.org/package=car" class="external-link"><strong>car</strong></a>,
<a href="https://CRAN.R-project.org/package=effects" class="external-link"><strong>effects</strong></a>,
<a href="https://CRAN.R-project.org/package=lmtest" class="external-link"><strong>lmtest</strong></a>,
and <a href="https://CRAN.R-project.org/package=sandwich" class="external-link"><strong>sandwich</strong></a>
packages, among others.</p>
<p>The package is accompanied by two online vignettes, namely this
introduction and an article introducing the regression diagnostics and
graphics:</p>
<ul>
<li><a href="https://zeileis.github.io/ivreg/articles/ivreg.html">ivreg:
Two-Stage Least-Squares Regression with Diagnostics</a></li>
<li><a href="https://zeileis.github.io/ivreg/articles/Diagnostics-for-2SLS-Regression.html">Diagnostics
for 2SLS Regression</a></li>
</ul>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The stable release version of <a href="https://CRAN.R-project.org/package=ivreg" class="external-link"><strong>ivreg</strong></a>
is hosted on the Comprehensive R Archive Network (CRAN) at <a href="https://CRAN.R-project.org/package=ivreg" class="external-link uri">https://CRAN.R-project.org/package=ivreg</a> and can be
installed along with all dependencies via</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"ivreg"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The development version of <strong>ivreg</strong> is hosted on GitHub
at <a href="https://github.com/zeileis/ivreg/" class="external-link uri">https://github.com/zeileis/ivreg/</a>. It can be
conveniently installed via the <code>install_github()</code> function in
the <a href="https://CRAN.R-project.org/package=remotes" class="external-link"><strong>remotes</strong></a>
package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"https://github.com/zeileis/ivreg/"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="instrumental-variables-regression">Instrumental variables regression<a class="anchor" aria-label="anchor" href="#instrumental-variables-regression"></a>
</h2>
<p>The main function in the <strong>ivreg</strong> package is
<code><a href="../reference/ivreg.html">ivreg()</a></code>, which is a high-level formula interface to the
work-horse <code><a href="../reference/ivreg.fit.html">ivreg.fit()</a></code> function; both functions return a
list of quantities similar to that returned by <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>
(including coefficients, coefficient variance-covariance matrix,
residuals, etc.). In the case of <code><a href="../reference/ivreg.html">ivreg()</a></code>, the returned list
is of class <code>"ivreg"</code>, for which a wide range of standard
methods is available, including <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>,
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, <code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code>, <code><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov()</a></code>,
<code><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova()</a></code>, <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>, <code><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals()</a></code>,
<code><a href="https://rdrr.io/r/stats/terms.html" class="external-link">terms()</a></code>, <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix()</a></code>,
<code><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula()</a></code>, <code><a href="https://rdrr.io/r/stats/update.html" class="external-link">update()</a></code>, <code><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hatvalues()</a></code>,
<code><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">dfbeta()</a></code>, and <code><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">rstudent()</a></code>. Moreover, methods
for functionality from other packages is provided, and is described in
more detail in a companion vignette.</p>
<p>Regressors and instruments for <code><a href="../reference/ivreg.html">ivreg()</a></code> are most easily
specified in a formula with two parts on the right-hand side, for
example, <code>y ~ x1 + x2 | x1 + z1 + z2</code>, where <code>x1</code>
and <code>x2</code> are, respectively, exogenous and endogenous
explanatory variables, and <code>x1</code>, <code>z1</code>, and
<code>z2</code> are instrumental variables. Both components on the
right-hand side of the model formula include an implied intercept,
unless, as in a linear model estimated by <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>, the
intercept is explicitly excluded via <code>-1</code>. Exogenous
explanatory variables, such as <code>x1</code> in the example, must be
included among the instruments. A worked example is described
immediately below. As listing exogenous variables in both parts on the
right-hand side of the formula may become tedious if there are many of
them, an additional convenience option is to use a three-part right side
like <code>y ~ x1 | x2 | z1 + z2</code>, listing the exogenous,
endogenous, and instrumental variables (for the endogenous variables
only), respectively.</p>
</div>
<div class="section level2">
<h2 id="illustration-returns-to-schooling">Illustration: Returns to schooling<a class="anchor" aria-label="anchor" href="#illustration-returns-to-schooling"></a>
</h2>
<p>As an initial demonstration of the <strong>ivreg</strong> package, we
investigate the effect of schooling on earnings in a classical model for
wage determination. The data are from the United States, and are
provided in the package as <code>SchoolingReturns</code>. This data set
was originally studied by David Card, and was subsequently employed, as
here, to illustrate 2SLS estimation in introductory econometrics
textbooks. The relevant variables for this illustration are:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"SchoolingReturns"</span>, package <span class="op">=</span> <span class="st">"ivreg"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SchoolingReturns</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       wage          education       experience     ethnicity     smsa     </span></span>
<span><span class="co">##  Min.   : 100.0   Min.   : 1.00   Min.   : 0.000   other:2307   no : 864  </span></span>
<span><span class="co">##  1st Qu.: 394.2   1st Qu.:12.00   1st Qu.: 6.000   afam : 703   yes:2146  </span></span>
<span><span class="co">##  Median : 537.5   Median :13.00   Median : 8.000                          </span></span>
<span><span class="co">##  Mean   : 577.3   Mean   :13.26   Mean   : 8.856                          </span></span>
<span><span class="co">##  3rd Qu.: 708.8   3rd Qu.:16.00   3rd Qu.:11.000                          </span></span>
<span><span class="co">##  Max.   :2404.0   Max.   :18.00   Max.   :23.000                          </span></span>
<span><span class="co">##  south           age        nearcollege</span></span>
<span><span class="co">##  no :1795   Min.   :24.00   no : 957   </span></span>
<span><span class="co">##  yes:1215   1st Qu.:25.00   yes:2053   </span></span>
<span><span class="co">##             Median :28.00              </span></span>
<span><span class="co">##             Mean   :28.12              </span></span>
<span><span class="co">##             3rd Qu.:31.00              </span></span>
<span><span class="co">##             Max.   :34.00</span></span></code></pre>
<p>A standard wage equation uses a semi-logarithmic linear regression
for <code>wage</code>, estimated by ordinary least squares (OLS), with
years of <code>education</code> as the primary explanatory variable,
adjusting for a quadratic term in labor-market <code>experience</code>,
as well as for factors coding <code>ethnicity</code>, residence in a
city (<code>smsa</code>), and residence in the U.S.
<code>south</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m_ols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">wage</span><span class="op">)</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">experience</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">ethnicity</span> <span class="op">+</span> <span class="va">smsa</span> <span class="op">+</span> <span class="va">south</span>,</span>
<span>  data <span class="op">=</span> <span class="va">SchoolingReturns</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m_ols</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = log(wage) ~ education + poly(experience, 2) + ethnicity + </span></span>
<span><span class="co">##     smsa + south, data = SchoolingReturns)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">## -1.59297 -0.22315  0.01893  0.24223  1.33190 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                       Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)           5.259820   0.048871 107.626  &lt; 2e-16 ***</span></span>
<span><span class="co">## education             0.074009   0.003505  21.113  &lt; 2e-16 ***</span></span>
<span><span class="co">## poly(experience, 2)1  8.931699   0.494804  18.051  &lt; 2e-16 ***</span></span>
<span><span class="co">## poly(experience, 2)2 -2.642043   0.374739  -7.050 2.21e-12 ***</span></span>
<span><span class="co">## ethnicityafam        -0.189632   0.017627 -10.758  &lt; 2e-16 ***</span></span>
<span><span class="co">## smsayes               0.161423   0.015573  10.365  &lt; 2e-16 ***</span></span>
<span><span class="co">## southyes             -0.124862   0.015118  -8.259  &lt; 2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.3742 on 3003 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.2905, Adjusted R-squared:  0.2891 </span></span>
<span><span class="co">## F-statistic: 204.9 on 6 and 3003 DF,  p-value: &lt; 2.2e-16</span></span></code></pre>
<p>Thus, OLS estimation yields an estimate of 7.4% per year for returns
to schooling. This estimate is problematic, however, because it can be
argued that <code>education</code> is endogenous (and hence also
<code>experience</code>, which is taken to be <code>age</code> minus
<code>education</code> minus 6). We therefore use geographical proximity
to a college when growing up as an exogenous instrument for
<code>education</code>. Additionally, <code>age</code> is the natural
exogenous instrument for <code>experience</code>, while the remaining
explanatory variables can be considered exogenous and are thus used as
instruments for themselves. Although it’s a useful strategy to select an
effective instrument or instruments for each endogenous explanatory
variable, in 2SLS regression all of the instrumental variables are used
to estimate all of the regression coefficients in the model.</p>
<p>To fit this model with <code><a href="../reference/ivreg.html">ivreg()</a></code> we can simply extend the
formula from <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> above, adding a second part after the
<code>|</code> separator to specify the instrumental variables:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://zeileis.github.io/ivreg/">"ivreg"</a></span><span class="op">)</span></span>
<span><span class="va">m_iv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ivreg.html">ivreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">wage</span><span class="op">)</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">experience</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">ethnicity</span> <span class="op">+</span> <span class="va">smsa</span> <span class="op">+</span> <span class="va">south</span> <span class="op">|</span></span>
<span>  <span class="va">nearcollege</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">age</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">ethnicity</span> <span class="op">+</span> <span class="va">smsa</span> <span class="op">+</span> <span class="va">south</span>,</span>
<span>  data <span class="op">=</span> <span class="va">SchoolingReturns</span><span class="op">)</span></span></code></pre></div>
<p>Equivalently, the same model can also be specified slightly more
concisely using three parts on the right-hand side indicating the
exogenous variables, the endogenous variables, and the additional
instrumental variables only (in addition to the exogenous
variables).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m_iv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ivreg.html">ivreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">wage</span><span class="op">)</span> <span class="op">~</span> <span class="va">ethnicity</span> <span class="op">+</span> <span class="va">smsa</span> <span class="op">+</span> <span class="va">south</span> <span class="op">|</span> <span class="va">education</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">experience</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">|</span></span>
<span>  <span class="va">nearcollege</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">age</span>, <span class="fl">2</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">SchoolingReturns</span><span class="op">)</span></span></code></pre></div>
<p>Both models yield the following results:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m_iv</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## ivreg(formula = log(wage) ~ education + poly(experience, 2) + </span></span>
<span><span class="co">##     ethnicity + smsa + south | nearcollege + poly(age, 2) + ethnicity + </span></span>
<span><span class="co">##     smsa + south, data = SchoolingReturns)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">## -1.82400 -0.25248  0.02286  0.26349  1.31561 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                      Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)           4.48522    0.67538   6.641 3.68e-11 ***</span></span>
<span><span class="co">## education             0.13295    0.05138   2.588 0.009712 ** </span></span>
<span><span class="co">## poly(experience, 2)1  9.14172    0.56350  16.223  &lt; 2e-16 ***</span></span>
<span><span class="co">## poly(experience, 2)2 -0.93810    1.58024  -0.594 0.552797    </span></span>
<span><span class="co">## ethnicityafam        -0.10314    0.07737  -1.333 0.182624    </span></span>
<span><span class="co">## smsayes               0.10798    0.04974   2.171 0.030010 *  </span></span>
<span><span class="co">## southyes             -0.09818    0.02876  -3.413 0.000651 ***</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Diagnostic tests:</span></span>
<span><span class="co">##                                          df1  df2 statistic  p-value    </span></span>
<span><span class="co">## Weak instruments (education)               3 3003     8.008 2.58e-05 ***</span></span>
<span><span class="co">## Weak instruments (poly(experience, 2)1)    3 3003  1612.707  &lt; 2e-16 ***</span></span>
<span><span class="co">## Weak instruments (poly(experience, 2)2)    3 3003   174.166  &lt; 2e-16 ***</span></span>
<span><span class="co">## Wu-Hausman                                 2 3001     0.841    0.432    </span></span>
<span><span class="co">## Sargan                                     0   NA        NA       NA    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.4032 on 3003 degrees of freedom</span></span>
<span><span class="co">## Multiple R-Squared: 0.1764,  Adjusted R-squared: 0.1747 </span></span>
<span><span class="co">## Wald test: 148.1 on 6 and 3003 DF,  p-value: &lt; 2.2e-16</span></span></code></pre>
<p>Thus, using two-stage least squares to estimate the regression yields
a much larger coefficient for the returns to schooling, namely 13.3% per
year. Notice as well that the standard errors of the coefficients are
larger for 2SLS estimation than for OLS, and that, partly as a
consequence, evidence for the effects of <code>ethnicity</code> and the
quadratic component of <code>experience</code> is now weak. These
differences are brought out more clearly when showing coefficients and
standard errors side by side, e.g., using the
<code><a href="https://rdrr.io/pkg/car/man/compareCoefs.html" class="external-link">compareCoefs()</a></code> function from the <strong>car</strong>
package or the <code><a href="https://modelsummary.com/man/msummary.html" class="external-link">msummary()</a></code> function from the <a href="https://CRAN.R-project.org/package=modelsummary" class="external-link"><strong>modelsummary</strong></a>
package:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://modelsummary.com" class="external-link">"modelsummary"</a></span><span class="op">)</span></span>
<span><span class="va">m_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>OLS <span class="op">=</span> <span class="va">m_ols</span>, IV <span class="op">=</span> <span class="va">m_iv</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://modelsummary.com/man/msummary.html" class="external-link">msummary</a></span><span class="op">(</span><span class="va">m_list</span><span class="op">)</span></span></code></pre></div>
<!-- preamble start -->

    <script>

      function styleCell_rrapy1m2305li10rw6b1(i, j, css_id) {
          var table = document.getElementById("tinytable_rrapy1m2305li10rw6b1");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_rrapy1m2305li10rw6b1');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_rrapy1m2305li10rw6b1(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_rrapy1m2305li10rw6b1");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 14, j: 0 },  ], css_id: 'tinytable_css_qbaehks92zd14h3igmus',}, 
          { positions: [ { i: 0, j: 0 },  ], css_id: 'tinytable_css_pd4bgcwwchv4awz6mnx7',}, 
          { positions: [ { i: 1, j: 1 }, { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 5, j: 1 }, { i: 2, j: 1 }, { i: 7, j: 1 }, { i: 8, j: 1 }, { i: 9, j: 1 }, { i: 6, j: 1 }, { i: 11, j: 1 }, { i: 12, j: 1 }, { i: 13, j: 1 }, { i: 4, j: 2 }, { i: 15, j: 1 }, { i: 16, j: 1 }, { i: 17, j: 1 }, { i: 18, j: 1 }, { i: 19, j: 1 }, { i: 20, j: 1 }, { i: 21, j: 1 }, { i: 12, j: 2 }, { i: 10, j: 1 }, { i: 1, j: 2 }, { i: 2, j: 2 }, { i: 3, j: 2 }, { i: 17, j: 2 }, { i: 5, j: 2 }, { i: 6, j: 2 }, { i: 7, j: 2 }, { i: 8, j: 2 }, { i: 9, j: 2 }, { i: 10, j: 2 }, { i: 11, j: 2 }, { i: 16, j: 2 }, { i: 13, j: 2 }, { i: 18, j: 2 }, { i: 15, j: 2 }, { i: 20, j: 2 }, { i: 21, j: 2 }, { i: 19, j: 2 },  ], css_id: 'tinytable_css_ijtdx5ntl7d2hervnp7p',}, 
          { positions: [ { i: 14, j: 2 }, { i: 14, j: 1 },  ], css_id: 'tinytable_css_fzwsoxmcup2gwkhqnxj4',}, 
          { positions: [ { i: 22, j: 1 }, { i: 22, j: 2 },  ], css_id: 'tinytable_css_bmj3iklkidrjok56654b',}, 
          { positions: [ { i: 22, j: 0 },  ], css_id: 'tinytable_css_9n8o98iosemua6rb2f7b',}, 
          { positions: [ { i: 1, j: 0 }, { i: 2, j: 0 }, { i: 3, j: 0 }, { i: 4, j: 0 }, { i: 5, j: 0 }, { i: 6, j: 0 }, { i: 7, j: 0 }, { i: 8, j: 0 }, { i: 9, j: 0 }, { i: 10, j: 0 }, { i: 11, j: 0 }, { i: 12, j: 0 }, { i: 13, j: 0 }, { i: 18, j: 0 }, { i: 15, j: 0 }, { i: 16, j: 0 }, { i: 17, j: 0 }, { i: 19, j: 0 }, { i: 20, j: 0 }, { i: 21, j: 0 },  ], css_id: 'tinytable_css_8oyhm3xhtibg9ckz0265',}, 
          { positions: [ { i: 0, j: 1 }, { i: 0, j: 2 },  ], css_id: 'tinytable_css_16hpwp18wfmevjq0o9ux',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_rrapy1m2305li10rw6b1(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script><style>
      /* tinytable css entries after */
      .table td.tinytable_css_qbaehks92zd14h3igmus, .table th.tinytable_css_qbaehks92zd14h3igmus { text-align: left; border-bottom: solid black 0.05em; }
      .table td.tinytable_css_pd4bgcwwchv4awz6mnx7, .table th.tinytable_css_pd4bgcwwchv4awz6mnx7 { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
      .table td.tinytable_css_ijtdx5ntl7d2hervnp7p, .table th.tinytable_css_ijtdx5ntl7d2hervnp7p { text-align: center; }
      .table td.tinytable_css_fzwsoxmcup2gwkhqnxj4, .table th.tinytable_css_fzwsoxmcup2gwkhqnxj4 { text-align: center; border-bottom: solid black 0.05em; }
      .table td.tinytable_css_bmj3iklkidrjok56654b, .table th.tinytable_css_bmj3iklkidrjok56654b { text-align: center; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_9n8o98iosemua6rb2f7b, .table th.tinytable_css_9n8o98iosemua6rb2f7b { text-align: left; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_8oyhm3xhtibg9ckz0265, .table th.tinytable_css_8oyhm3xhtibg9ckz0265 { text-align: left; }
      .table td.tinytable_css_16hpwp18wfmevjq0o9ux, .table th.tinytable_css_16hpwp18wfmevjq0o9ux { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
<div class="container">
      <table class="table table table-borderless" id="tinytable_rrapy1m2305li10rw6b1" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
<thead><tr>
<th scope="col"> </th>
                <th scope="col">OLS</th>
                <th scope="col">IV</th>
              </tr></thead>
<tbody>
<tr>
<td>(Intercept)         </td>
                  <td>5.260    </td>
                  <td>4.485  </td>
                </tr>
<tr>
<td>                    </td>
                  <td>(0.049)  </td>
                  <td>(0.675)</td>
                </tr>
<tr>
<td>education           </td>
                  <td>0.074    </td>
                  <td>0.133  </td>
                </tr>
<tr>
<td>                    </td>
                  <td>(0.004)  </td>
                  <td>(0.051)</td>
                </tr>
<tr>
<td>poly(experience, 2)1</td>
                  <td>8.932    </td>
                  <td>9.142  </td>
                </tr>
<tr>
<td>                    </td>
                  <td>(0.495)  </td>
                  <td>(0.564)</td>
                </tr>
<tr>
<td>poly(experience, 2)2</td>
                  <td>-2.642   </td>
                  <td>-0.938 </td>
                </tr>
<tr>
<td>                    </td>
                  <td>(0.375)  </td>
                  <td>(1.580)</td>
                </tr>
<tr>
<td>ethnicityafam       </td>
                  <td>-0.190   </td>
                  <td>-0.103 </td>
                </tr>
<tr>
<td>                    </td>
                  <td>(0.018)  </td>
                  <td>(0.077)</td>
                </tr>
<tr>
<td>smsayes             </td>
                  <td>0.161    </td>
                  <td>0.108  </td>
                </tr>
<tr>
<td>                    </td>
                  <td>(0.016)  </td>
                  <td>(0.050)</td>
                </tr>
<tr>
<td>southyes            </td>
                  <td>-0.125   </td>
                  <td>-0.098 </td>
                </tr>
<tr>
<td>                    </td>
                  <td>(0.015)  </td>
                  <td>(0.029)</td>
                </tr>
<tr>
<td>Num.Obs.            </td>
                  <td>3010     </td>
                  <td>3010   </td>
                </tr>
<tr>
<td>R2                  </td>
                  <td>0.291    </td>
                  <td>0.176  </td>
                </tr>
<tr>
<td>R2 Adj.             </td>
                  <td>0.289    </td>
                  <td>0.175  </td>
                </tr>
<tr>
<td>AIC                 </td>
                  <td>40329.6  </td>
                  <td>40778.6</td>
                </tr>
<tr>
<td>BIC                 </td>
                  <td>40377.7  </td>
                  <td>40826.7</td>
                </tr>
<tr>
<td>Log.Lik.            </td>
                  <td>-1308.702</td>
                  <td>       </td>
                </tr>
<tr>
<td>F                   </td>
                  <td>204.932  </td>
                  <td>       </td>
                </tr>
<tr>
<td>RMSE                </td>
                  <td>0.37     </td>
                  <td>0.40   </td>
                </tr>
</tbody>
</table>
</div>
<!-- hack to avoid NA insertion in last line -->
<p>The change in coefficients and associated standard errors can also be
brought out graphically using the <code><a href="https://modelsummary.com/man/modelplot.html" class="external-link">modelplot()</a></code> function from
<strong>modelsummary</strong> which shows the coefficient estimates
along with their 95% confidence intervals. Below we omit the intercept
and experience terms as these are on a different scale than the other
coefficients.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://modelsummary.com/man/modelplot.html" class="external-link">modelplot</a></span><span class="op">(</span><span class="va">m_list</span>, coef_omit <span class="op">=</span> <span class="st">"Intercept|experience"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ivreg_files/figure-html/modelplot-1.png" width="672"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by John Fox, Christian Kleiber, Achim Zeileis.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
